<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FishyLife - Fishing</title>
<style>
body{
    margin:0;
    font-family:Arial;
    background:#4db8ff;
    color:white;
    text-align:center;
}
header{
    display:flex;
    justify-content:space-around;
    padding:10px;
    background:rgba(0,0,0,.35);
}
header a{
    color:white;
    text-decoration:none;
}
#track{
    width:520px;
    height:40px;
    background:#1f618d;
    border-radius:25px;
    margin:30px auto;
    position:relative;
}
#fish{
    width:20px;
    height:20px;
    background:white;
    border-radius:50%;
    position:absolute;
    top:10px;
}
#box{
    width:120px;
    height:40px;
    border:3px solid red;
    position:absolute;
    top:0;
}
.barWrap{
    width:520px;
    height:16px;
    background:#222;
    margin:6px auto;
    border-radius:8px;
}
.bar{
    height:100%;
    width:0%;
    background:lime;
    border-radius:8px;
}
button{
    padding:12px 18px;
    font-size:20px;
    margin:10px;
    cursor:pointer;
}
#rarityText{
    font-size:18px;
    margin:8px 0;
}
</style>
</head>
<body>

<header>
<a href="index.html">üè† Home</a>
<a href="shop.html">üõí Shop</a>
</header>

<h1>üé£ Fishing</h1>
<p>Keep the fish inside the red box!</p>

<div id="track">
    <div id="fish"></div>
    <div id="box"></div>
</div>

<div class="barWrap">
    <div id="catchBar" class="bar"></div>
</div>

<p id="rarityText"></p>

<button id="left">‚¨ÖÔ∏è</button>
<button id="right">‚û°Ô∏è</button>

<script>
// ----- LOAD GAME -----
let g = JSON.parse(localStorage.getItem("game"));
if(!g){
    alert("No save found! Returning to home.");
    location.href="index.html";
}
if(g.bait <= 0){
    alert("No bait! Returning to shop.");
    location.href="shop.html";
}
g.bait--;
localStorage.setItem("game", JSON.stringify(g));

// ----- FISH DATA -----
const fish = { name:"Bass", xp:20, rarity:1.2 };

// ----- RARITY FUNCTION -----
function rarityName(r){
    if(r < 1) return "Common";
    else if(r >= 1 && r < 1.3) return "Uncommon";
    else if(r >= 1.3 && r < 1.6) return "Rare";
    else if(r >= 1.6 && r < 2) return "Epic";
    else return "Legendary";
}
document.getElementById("rarityText").textContent = "Category: " + rarityName(fish.rarity);

// ----- VARIABLES -----
const BAR = 520;
let fishX = 250;
let fishDir = Math.random()<0.5?-1:1;
let boxX = 200;
let move = 0;
let boxW = 120;
let catchProg = 0;

const box = document.getElementById("box");
const fishEl = document.getElementById("fish");
const catchBar = document.getElementById("catchBar");
box.style.width = boxW + "px";

// ----- INPUT -----
document.onkeydown = e=>{
    if(e.key==="ArrowLeft") move=-1;
    if(e.key==="ArrowRight") move=1;
};
document.onkeyup = ()=>move=0;
document.getElementById("left").onmousedown = ()=>move=-1;
document.getElementById("right").onmousedown = ()=>move=1;
document.getElementById("left").onmouseup = document.getElementById("right").onmouseup = ()=>move=0;

// ----- MAIN LOOP -----
const loop = setInterval(()=>{
    // Fish movement
    fishX += fishDir * (2 + fish.rarity);
    if(Math.random() < 0.02) fishDir *= -1;
    if(fishX < 0 || fishX > BAR - 20) fishDir *= -1;
    fishEl.style.left = fishX + "px";

    // Box movement
    boxX += move * 6;
    boxX = Math.max(0, Math.min(BAR - boxW, boxX));
    box.style.left = boxX + "px";

    // Catch progress
    const center = fishX + 10;
    const inside = center > boxX && center < boxX + boxW;
    if(inside) catchProg += 0.8;
    else catchProg -= 0.6 * fish.rarity;
    catchProg = Math.max(0, Math.min(100, catchProg));
    catchBar.style.width = catchProg + "%";

    // Catch completed
    if(catchProg >= 100){
        clearInterval(loop);
        g.inventory[fish.name] = (g.inventory[fish.name]||0) + 1;
        g.money += fish.xp;
        g.xp += fish.xp;
        localStorage.setItem("game", JSON.stringify(g));
        alert("üêü You caught a " + fish.name + "!");
        location.href="index.html";
    }
}, 16);
</script>

</body>
</html>
