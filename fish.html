<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FishyLife - Fishing</title>
<style>
body{margin:0;font-family:Arial;background:#4db8ff;color:white;text-align:center;}
header{display:flex;justify-content:space-around;padding:10px;background:rgba(0,0,0,.35);}
header a{color:white;text-decoration:none;}
h1{text-align:center;}
#gameArea{position:relative;margin:20px auto;width:360px;height:400px;background:rgba(0,0,0,.35);}
#fishBox{position:absolute;width:60px;height:60px;border:3px solid yellow;border-radius:8px;top:170px;left:150px;}
#catchBar{position:absolute;width:100px;height:15px;background:lime;top:370px;left:130px;border-radius:4px;}
#fishName{margin-top:10px;font-weight:bold;}
</style>
</head>
<body>

<header>
<a href="index.html">üè† Home</a>
<a href="shop.html">üõí Shop</a>
<a href="aquarium.html">üê† Aquarium</a>
<a href="quests.html">üéØ Quests</a>
</header>

<h1>üé£ Fishing</h1>
<div id="gameArea">
    <div id="fishBox"></div>
    <div id="catchBar"></div>
</div>
<div id="fishName">--</div>
<button onclick="startFishing()">Start Fishing</button>

<script>
// ---------- LOAD GAME ----------
let g = JSON.parse(localStorage.getItem("game"));
if(!g){ alert("No save found!"); location.href="index.html"; }

// ---------- FISH DATA ----------
const fishData = [
    // River
    {name:"Minnow",location:"River",rarity:"Common"},
    {name:"Bluegill",location:"River",rarity:"Common"},
    {name:"Largemouth Bass",location:"River",rarity:"Uncommon"},
    {name:"Smallmouth Bass",location:"River",rarity:"Uncommon"},
    {name:"Rainbow Trout",location:"River",rarity:"Uncommon"},
    {name:"Brown Trout",location:"River",rarity:"Uncommon"},
    {name:"Brook Trout",location:"River",rarity:"Rare"},
    {name:"Red Crawfish",location:"River",rarity:"Uncommon"},
    {name:"Blue Crawfish",location:"River",rarity:"Rare"},
    {name:"Freshwater Shark",location:"River",rarity:"Legendary"},
    {name:"Oscar",location:"River",rarity:"Rare"},
    {name:"Pike",location:"River",rarity:"Rare"},
    // Ocean
    {name:"Tuna",location:"Ocean",rarity:"Uncommon"},
    {name:"Marlin",location:"Ocean",rarity:"Rare"},
    {name:"Swordfish",location:"Ocean",rarity:"Rare"},
    {name:"Great White Shark",location:"Ocean",rarity:"Legendary"},
    {name:"Tiger Shark",location:"Ocean",rarity:"Legendary"},
    {name:"Hammerhead Shark",location:"Ocean",rarity:"Epic"},
    {name:"Stingray",location:"Ocean",rarity:"Rare"},
    {name:"Manta Ray",location:"Ocean",rarity:"Epic"},
    {name:"Lanternfish",location:"Ocean",rarity:"Rare"},
    {name:"Anglerfish",location:"Ocean",rarity:"Legendary"},
    {name:"Blobfish",location:"Ocean",rarity:"Mythical"}
];

// ---------- FISHING MECHANICS ----------
let fishBox = document.getElementById("fishBox");
let catchBar = document.getElementById("catchBar");
let fishNameDisplay = document.getElementById("fishName");
let fishing = false;
let currentFish = null;

function startFishing(){
    if(fishing){ alert("Already fishing!"); return; }
    if(g.bait<=0){ alert("Not enough bait!"); return; }
    g.bait--; localStorage.setItem("game",JSON.stringify(g));
    fishing = true;
    
    // Pick random fish for current location
    const locFish = fishData.filter(f=>f.location===g.location);
    const weighted = [];
    locFish.forEach(f=>{
        let weight = 1;
        switch(f.rarity){
            case "Common": weight=50; break;
            case "Uncommon": weight=25; break;
            case "Rare": weight=10; break;
            case "Epic": weight=5; break;
            case "Legendary": weight=2; break;
            case "Mythical": weight=1; break;
        }
        for(let i=0;i<weight;i++) weighted.push(f);
    });
    currentFish = weighted[Math.floor(Math.random()*weighted.length)];
    fishNameDisplay.textContent = currentFish.name + " (" + currentFish.rarity + ")";
    
    // Arcade style fish movement
    let topPos = Math.random()*340;
    let leftPos = Math.random()*300;
    let speed = Math.random()*4+2; // faster and slippery
    
    const moveInterval = setInterval(()=>{
        if(!fishing){ clearInterval(moveInterval); return; }
        const dx = (Math.random()*2-1)*speed;
        const dy = (Math.random()*2-1)*speed;
        topPos += dy; leftPos += dx;
        topPos = Math.max(0,Math.min(340,topPos));
        leftPos = Math.max(0,Math.min(300,leftPos));
        fishBox.style.top = topPos + "px";
        fishBox.style.left = leftPos + "px";
        
        // Check if fishBox inside catchBar (vertical)
        const barTop = 370, barBottom = 385;
        if(topPos >= barTop && topPos+60 <= barBottom+60){
            // Fish caught
            catchFish();
            clearInterval(moveInterval);
        }
    },50);
}

// ---------- CATCH FISH ----------
function catchFish(){
    alert("You caught a " + currentFish.name + "!");
    g.inventory[currentFish.name] = (g.inventory[currentFish.name]||0)+1;
    g.caught[currentFish.name] = true;
    g.fishCount++;
    localStorage.setItem("game",JSON.stringify(g));
    fishing=false;
    fishNameDisplay.textContent="--";
}
</script>

</body>
</html>
