<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FishyLife - Fishing</title>
<style>
body{margin:0;font-family:Arial;background:#4db8ff;color:white;text-align:center;}
header{display:flex;justify-content:space-around;padding:10px;background:rgba(0,0,0,.35);}
header a{color:white;text-decoration:none;}
#track{width:520px;height:40px;background:#1f618d;border-radius:25px;margin:30px auto;position:relative;}
#fish{width:20px;height:20px;background:white;border-radius:50%;position:absolute;top:10px;}
#box{height:40px;border:3px solid red;position:absolute;top:0;}
.barWrap{width:520px;height:16px;background:#222;margin:6px auto;border-radius:8px;}
.bar{height:100%;width:0%;background:lime;border-radius:8px;}
button{padding:12px 18px;font-size:20px;margin:10px;cursor:pointer;}
</style>
</head>
<body>

<header>
<a href="index.html">üè† Home</a>
<a href="shop.html">üõí Shop</a>
</header>

<h1>üé£ Fishing</h1>
<p>Keep the fish inside the red box</p>

<div id="track">
    <div id="fish"></div>
    <div id="box"></div>
</div>

<div class="barWrap"><div id="catchBar" class="bar"></div></div>
<p id="rarityText"></p>

<button id="left">‚¨ÖÔ∏è</button>
<button id="right">‚û°Ô∏è</button>

<script>
let g=JSON.parse(localStorage.getItem("game"));
if(!g){location.href="index.html";}
if(g.bait<=0){alert("No bait");location.href="shop.html";}
g.bait--;

const fishByLoc={
Creek:[{name:"Minnow",xp:10,r:0.6},{name:"Bass",xp:20,r:1.2}],
Lake:[{name:"Salmon",xp:40,r:1.7},{name:"Catfish",xp:30,r:1.4}],
Ocean:[{name:"Moonfish",xp:55,r:1.7},{name:"Abyssal Octopus",xp:500,r:3}]
};

let fish;

// ADMIN OVERRIDE
if(g.adminMode){
    fish={name:"Abyssal Octopus",xp:500,r:3};
}else{
    const list=fishByLoc[g.location];
    fish={...list[Math.floor(Math.random()*list.length)]};
}

function category(r){
    if(r<1) return "Common";
    if(r<1.2) return "Uncommon";
    if(r<1.5) return "Rare";
    if(r<2) return "Epic";
    return "Legendary";
}

rarityText.textContent="Category: "+category(fish.r);

const BAR=520;
let fishX=260,dir=1,boxX=200,move=0;
let boxW=100+(g.rod?10:0);
box.style.width=boxW+"px";
let prog=0;

document.onkeydown=e=>move=e.key==="ArrowLeft"?-1:e.key==="ArrowRight"?1:move;
document.onkeyup=()=>move=0;
left.onmousedown=()=>move=-1;
right.onmousedown=()=>move=1;
left.onmouseup=right.onmouseup=()=>move=0;

const loop=setInterval(()=>{
    fishX+=dir*(2+fish.r);
    if(fishX<0||fishX>BAR-20) dir*=-1;
    fish.style.left=fishX+"px";

    boxX+=move*6;
    boxX=Math.max(0,Math.min(BAR-boxW,boxX));
    box.style.left=boxX+"px";

    const inside=fishX+10>boxX&&fishX+10<boxX+boxW;
    prog+=inside?1:-fish.r;
    prog=Math.max(0,Math.min(100,prog));
    catchBar.style.width=prog+"%";

    if(prog>=100){
        clearInterval(loop);
        g.inventory[fish.name]=(g.inventory[fish.name]||0)+1;
        g.caught[fish.name]=true;
        g.money+=fish.xp;
        g.xp+=fish.xp;
        while(g.xp>=g.xpNeed){
            g.xp-=g.xpNeed;
            g.level++;
            g.xpNeed=Math.floor(g.xpNeed*1.5);
        }
        localStorage.setItem("game",JSON.stringify(g));
        alert("Caught: "+fish.name);
        location.href="index.html";
    }
},16);
</script>
</body>
</html>
