<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FishyLife - Fishing</title>
<style>
body{margin:0;font-family:Arial;background:#4db8ff;color:white;text-align:center;}
header{display:flex;justify-content:space-around;padding:10px;background:rgba(0,0,0,.35);}
header a{color:white;text-decoration:none;}
#track{width:520px;height:40px;background:#1f618d;border-radius:25px;margin:30px auto;position:relative;}
#fish{width:20px;height:20px;background:white;border-radius:50%;position:absolute;top:10px;}
#box{width:120px;height:40px;border:3px solid red;position:absolute;top:0;}
.barWrap{width:520px;height:16px;background:#222;margin:6px auto;border-radius:8px;}
.bar{height:100%;width:0%;border-radius:8px;}
#catchBar{background:lime;}
#rarityText{margin:6px;font-weight:bold;}
button{padding:12px 18px;font-size:20px;margin:10px;cursor:pointer;}
</style>
</head>
<body>

<header>
<a href="index.html">üè† Home</a>
<a href="shop.html">üõí Shop</a>
</header>

<h1>üé£ Fishing</h1>
<p>Keep the fish inside the red box to catch it!</p>

<div id="track">
    <div id="fish"></div>
    <div id="box"></div>
</div>

<div class="barWrap"><div id="catchBar" class="bar"></div></div>
<div id="rarityText">Rarity: </div>

<button id="left">‚¨ÖÔ∏è</button>
<button id="right">‚û°Ô∏è</button>

<script>
// ----- LOAD GAME -----
let g = JSON.parse(localStorage.getItem("game")) || null;
if(!g){ alert("No save found! Returning to home."); location.href="index.html"; }
if(g.bait <= 0){ alert("No bait!"); location.href="shop.html"; }
else g.bait--;
localStorage.setItem("game", JSON.stringify(g));

// ----- FISH DATA PER LOCATION -----
const fishByLoc={
Creek:[{name:"Minnow",xp:10,rarity:0.6},{name:"Bluegill",xp:15,rarity:0.9},{name:"Bass",xp:20,rarity:1.2},{name:"Tilapia",xp:25,rarity:1.0},{name:"Clownfish",xp:30,rarity:1.1}],
Lake:[{name:"Trout",xp:25,rarity:1.1},{name:"Catfish",xp:30,rarity:1.4},{name:"Salmon",xp:40,rarity:1.7},{name:"Peacock Bass",xp:50,rarity:1.6},{name:"Turtle",xp:35,rarity:1.0},{name:"Kepper",xp:35,rarity:1.0}],
Ocean:[{name:"Red Snapper",xp:45,rarity:1.5},{name:"Moonfish",xp:55,rarity:1.7},{name:"Tigershark",xp:150,rarity:2.2},{name:"Basa",xp:40,rarity:1.2},{name:"Goldfish",xp:20,rarity:0.9},{name:"Angelfish",xp:22,rarity:1.0},{name:"Lemonshark",xp:120,rarity:2.0},{name:"Lungfish",xp:45,rarity:1.1},{name:"Squid",xp:35,rarity:1.0},{name:"Crabs",xp:20,rarity:0.9},{name:"Crawfish",xp:15,rarity:0.8},{name:"Mussels",xp:25,rarity:1.0},{name:"Clams",xp:25,rarity:1.0},{name:"Abyssal Octopus",xp:500,rarity:3.0}]
};

// ----- PICK RANDOM FISH -----
const list = fishByLoc[g.location];
const fish = {...list[Math.floor(Math.random()*list.length)]};

// ----- VARIABLES -----
const BAR = 520;
let fishX = 250, fishDir = Math.random()<0.5?-1:1;
let boxX = 200, move = 0;
let boxW = 100 + (g.rod.includes("Rod")?1:0)*10;
document.getElementById("box").style.width = boxW + "px";

let catchProg = 0;
const catchBar = document.getElementById("catchBar");
const rarityText = document.getElementById("rarityText");

// Determine rarity text
function getRarityText(r){
    if(r < 0.8) return "Common";
    else if(r < 1.2) return "Uncommon";
    else if(r < 1.8) return "Rare";
    else return "Legendary";
}
rarityText.textContent = "Rarity: " + getRarityText(fish.rarity);

// ----- INPUT -----
document.onkeydown = e=>{ if(e.key==="ArrowLeft") move=-1; if(e.key==="ArrowRight") move=1; };
document.onkeyup = ()=>move=0;
document.getElementById("left").onmousedown = ()=>move=-1;
document.getElementById("right").onmousedown = ()=>move=1;
document.getElementById("left").onmouseup = document.getElementById("right").onmouseup = ()=>move=0;

// ----- MUTATION FUNCTION -----
function applyMutation(f){
    const rand = Math.random();
    let mult = 1, name="";
    if(rand<0.001 && f.name==="Clams"){ mult=25; name="Pearl"; }
    else if(rand<0.005){ mult=10; name="Rainbow"; }
    else if(rand<0.02){ mult=1.5; name="Gold"; }
    else if(rand<0.05){ mult=1.1; name="Silver"; }
    else if(rand<0.08){ mult=3; name="Raged"; }
    else if(rand<0.12){ mult=6; name="Burnt"; }
    else name="";
    return {mut:name,mult};
}

// ----- MAIN LOOP -----
const loop = setInterval(()=>{
    fishX += fishDir * (2 + fish.rarity);
    if(Math.random()<0.02) fishDir *= -1;
    if(fishX<0 || fishX>BAR-20) fishDir*=-1;
    document.getElementById("fish").style.left = fishX+"px";

    boxX += move*6;
    boxX = Math.max(0, Math.min(BAR-boxW, boxX));
    document.getElementById("box").style.left = boxX+"px";

    const center = fishX + 10;
    const inside = center > boxX && center < boxX + boxW;
    if(inside) catchProg += 0.8;
    else catchProg -= 0.6 * fish.rarity;

    catchProg = Math.max(0, Math.min(100, catchProg));
    catchBar.style.<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FishyLife ‚Äì Fishing</title>
<style>
body{margin:0;font-family:Arial;background:#4db8ff;color:white;text-align:center;}
header{display:flex;justify-content:space-around;padding:10px;background:rgba(0,0,0,.35);}
header a{color:white;text-decoration:none;}
#track{width:520px;height:40px;background:#1f618d;border-radius:25px;margin:20px auto;position:relative;overflow:hidden;}
#fish{width:18px;height:18px;background:white;border-radius:50%;position:absolute;top:11px;}
#box{height:40px;border:3px solid red;position:absolute;top:0;}
.barWrap{width:520px;height:14px;background:#222;margin:6px auto;border-radius:8px;}
.bar{height:100%;width:0%;border-radius:8px;}
#catchBar{background:lime;}
button{padding:12px 18px;font-size:18px;margin:6px;}
.skill{background:rgba(0,0,0,.3);margin:6px;padding:8px;border-radius:8px;}
</style>
</head>
<body>

<header>
<a href="index.html">üè† Home</a>
<a href="shop.html">üõí Shop</a>
</header>

<h1>üé£ Fishing</h1>

<div>üåä Depth: <span id="depthText"></span></div>

<div id="track">
    <div id="fish"></div>
    <div id="box"></div>
</div>

<div class="barWrap"><div id="catchBar" class="bar"></div></div>
<div id="rarityText"></div>

<button id="left">‚¨ÖÔ∏è</button>
<button id="right">‚û°Ô∏è</button>

<h2>üåü Skill Tree</h2>
<div id="skills"></div>

<script>
// ================= LOAD GAME =================
let g = JSON.parse(localStorage.getItem("game"));
if(!g){ alert("No save!"); location.href="index.html"; }

g.skills ??= {control:0,power:0,glide:0};
g.skillPoints ??= 0;

// ================= BAIT SYSTEM =================
const baitType = g.baitType || "Basic";
const baitBoost = {
    Basic:{rarity:1},
    Advanced:{rarity:1.2},
    Shiny:{rarity:1.6}
}[baitType] || {rarity:1};

// ================= DEPTH SYSTEM =================
const depth = Math.floor(Math.random()*100)+1;
document.getElementById("depthText").textContent = depth+"m";

// ================= FISH =================
const fish = {
    name:"Mystery Fish",
    rarity:(1 + depth/80) * baitBoost.rarity,
    xp:Math.floor(20 + depth*1.5)
};
document.getElementById("rarityText").textContent =
fish.rarity<1.2?"Common":fish.rarity<1.8?"Rare":"Legendary";

// ================= PHYSICS =================
const BAR=520;
let fishX=260, fishV=(Math.random()*2+1)*(Math.random()<.5?-1:1);

let boxX=200, boxV=0;
const gravity = 0.4;
const friction = 0.92;

// box size scales with skill
const boxW = 90 + g.skills.control*15;
document.getElementById("box").style.width = boxW+"px";

let input=0;

// ================= INPUT =================
document.onkeydown=e=>{
    if(e.key==="ArrowLeft") input=-1;
    if(e.key==="ArrowRight") input=1;
};
document.onkeyup=()=>input=0;

document.getElementById("left").onmousedown=()=>input=-1;
document.getElementById("right").onmousedown=()=>input=1;
document.getElementById("left").onmouseup=
document.getElementById("right").onmouseup=()=>input=0;

// ================= CATCH =================
let catchProg=0;
const bar=document.getElementById("catchBar");

// ================= MAIN LOOP =================
const loop=setInterval(()=>{
    // Fish motion
    fishV += (Math.random()-0.5)*0.4*fish.rarity;
    fishX += fishV;
    if(fishX<0||fishX>BAR-18) fishV*=-1;
    document.getElementById("fish").style.left=fishX+"px";

    // Box physics (velocity + inertia)
    boxV += input * (1.2 + g.skills.power*0.4);
    boxV *= friction;
    boxX += boxV;
    boxX=Math.max(0,Math.min(BAR-boxW,boxX));
    document.getElementById("box").style.left=boxX+"px";

    // Catch logic
    const center=fishX+9;
    const inside=center>boxX && center<boxX+boxW;
    catchProg += inside ? (1+g.skills.power*0.6) : -(0.8+fish.rarity*0.4);
    catchProg=Math.max(0,Math.min(100,catchProg));
    bar.style.width=catchProg+"%";

    if(catchProg>=100){
        clearInterval(loop);
        g.xp+=fish.xp;
        g.inventory[fish.name]=(g.inventory[fish.name]||0)+1;
        g.skillPoints++;
        localStorage.setItem("game",JSON.stringify(g));
        alert(`üêü Caught fish at ${depth}m!\n+${fish.xp} XP\n+1 Skill Point`);
        location.href="index.html";
    }
},16);

// ================= SKILL TREE =================
const skillDiv=document.getElementById("skills");
const skillData=[
    {key:"control",name:"Control",desc:"Bigger catch box"},
    {key:"power",name:"Power",desc:"Faster catch"},
    {key:"glide",name:"Glide",desc:"Less friction"}
];

function renderSkills(){
    skillDiv.innerHTML="";
    skillData.forEach(s=>{
        const d=document.createElement("div");
        d.className="skill";
        d.innerHTML=`${s.name} (${g.skills[s.key]})<br>${s.desc}<br>`;
        const b=document.createElement("button");
        b.textContent="Upgrade";
        b.onclick=()=>{
            if(g.skillPoints<=0){alert("No skill points");return;}
            g.skills[s.key]++;
            g.skillPoints--;
            localStorage.setItem("game",JSON.stringify(g));
            location.reload();
        };
        d.appendChild(b);
        skillDiv.appendChild(d);
    });
}
renderSkills();
</script>
</body>
</html>
