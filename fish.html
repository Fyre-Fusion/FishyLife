<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FishyLife - Fishing</title>
<style>
body{
    margin:0;
    font-family:Arial;
    background:#4db8ff;
    color:white;
    text-align:center;
}
header{
    display:flex;
    justify-content:space-around;
    padding:10px;
    background:rgba(0,0,0,.35);
}
header a{color:white;text-decoration:none;}

#track{
    width:520px;
    height:40px;
    background:#1f618d;
    border-radius:25px;
    margin:30px auto;
    position:relative;
}

#fish{
    width:20px;
    height:20px;
    background:white;
    border-radius:50%;
    position:absolute;
    top:10px;
    left:250px;
}

#box{
    width:120px;
    height:40px;
    border:3px solid red;
    position:absolute;
    top:0;
    left:200px;
}

.barWrap{
    width:520px;
    height:16px;
    background:#222;
    border-radius:8px;
    margin:8px auto;
}
.bar{
    height:100%;
    width:0%;
    border-radius:8px;
}

#catchBar{ background:lime; }
#rarityBar{ background:violet; }

button{
    padding:12px 18px;
    font-size:20px;
    margin:10px;
}
</style>
</head>
<body>

<header>
<a href="index.html">üè† Home</a>
<a href="shop.html">üõí Shop</a>
</header>

<h1>üé£ Fishing</h1>
<p>Keep the fish inside the red box</p>

<div id="track">
    <div id="fish"></div>
    <div id="box"></div>
</div>

<div class="barWrap">
    <div id="catchBar" class="bar"></div>
</div>
<div class="barWrap">
    <div id="rarityBar" class="bar"></div>
</div>

<button id="left">‚¨ÖÔ∏è</button>
<button id="right">‚û°Ô∏è</button>

<script>
// -------- LOAD GAME SAFELY --------
let g = JSON.parse(sessionStorage.getItem("game")) || {
    level:1,xp:0,xpNeed:50,money:0,bait:99,rod:1,
    inventory:{},caught:{},fishCount:0,location:"Creek"
};

// -------- FISH DATA --------
const fishByLoc={
    Creek:[
        {name:"Minnow",xp:10,rarity:0.6},
        {name:"Bluegill",xp:15,rarity:0.9},
        {name:"Bass",xp:20,rarity:1.2}
    ],
    Lake:[
        {name:"Trout",xp:25,rarity:1.1},
        {name:"Catfish",xp:30,rarity:1.4},
        {name:"Salmon",xp:40,rarity:1.7}
    ],
    Ocean:[
        {name:"Golden Carp",xp:60,rarity:1.6},
        {name:"Mythic Koi",xp:100,rarity:2.0},
        {name:"Ancient Leviathan",xp:300,rarity:2.6}
    ]
};

// pick random fish
const list = fishByLoc[g.location];
const fish = list[Math.floor(Math.random()*list.length)];

// -------- VARIABLES --------
const BAR = 520;
let fishX = 250;
let fishDir = Math.random()<0.5?-1:1;

let boxX = 200;
let boxW = 100 + g.rod*10;
box.style.width = boxW+"px";

let catchProg = 0;
let move = 0;

// rarity meter = difficulty
let rarityProg = fish.rarity * 35;
rarityBar.style.width = rarityProg+"%";

// -------- INPUT --------
document.onkeydown = e=>{
    if(e.key==="ArrowLeft") move=-1;
    if(e.key==="ArrowRight") move=1;
};
document.onkeyup = ()=>move=0;

left.onmousedown = ()=>move=-1;
right.onmousedown = ()=>move=1;
left.onmouseup = right.onmouseup = ()=>move=0;

// -------- MAIN LOOP --------
const loop = setInterval(()=>{
    // fish move
    fishX += fishDir * (2 + fish.rarity);
    if(Math.random()<0.02) fishDir *= -1;
    if(fishX<=0 || fishX>=BAR-20) fishDir *= -1;
    fish.style.left = fishX+"px";

    // box move
    boxX += move * 6;
    if(boxX<0) boxX=0;
    if(boxX>BAR-boxW) boxX=BAR-boxW;
    box.style.left = boxX+"px";

    // progress logic
    const center = fishX + 10;
    const inside = center > boxX && center < boxX + boxW;

    if(inside){
        catchProg += 0.8;
    }else{
        catchProg -= 0.6 * fish.rarity;
    }

    catchProg = Math.max(0, Math.min(100, catchProg));
    catchBar.style.width = catchProg+"%";

    // ---- CATCH ----
    if(catchProg >= 100){
        clearInterval(loop);

        g.inventory[fish.name] = (g.inventory[fish.name]||0)+1;
        g.caught[fish.name] = true;
        g.fishCount++;
        g.xp += fish.xp;

        while(g.xp >= g.xpNeed){
            g.xp -= g.xpNeed;
            g.level++;
            g.xpNeed = Math.floor(g.xpNeed*1.5);
        }

        sessionStorage.setItem("game", JSON.stringify(g));
        alert("üêü You caught a "+fish.name+"!");
        location.href="index.html";
    }
},16);
</script>

</body>
</html>

